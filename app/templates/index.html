{% extends "base.html" %}
{% block title %}Task Dashboard{% endblock %}

{% block content %}
<!-- üßÆ Dashboard Summary -->
<div class="row text-center mb-4">
  <div class="col-md-4 mb-3">
    <div class="card bg-dark text-light border-primary">
      <div class="card-body">
        <h6 class="text-secondary mb-2">Total Tasks</h6>
        <h3 class="fw-bold text-primary">{{ total }}</h3>
      </div>
    </div>
  </div>
  <div class="col-md-4 mb-3">
    <div class="card bg-dark text-light border-success">
      <div class="card-body">
        <h6 class="text-secondary mb-2">Completed</h6>
        <h3 class="fw-bold text-success">{{ completed }}</h3>
      </div>
    </div>
  </div>
  <div class="col-md-4 mb-3">
    <div class="card bg-dark text-light border-warning">
      <div class="card-body">
        <h6 class="text-secondary mb-2">Pending</h6>
        <h3 class="fw-bold text-warning">{{ pending }}</h3>
      </div>
    </div>
  </div>
</div>

<!-- üîç Filter + Sort Bar -->
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
  <div>
    <h5 class="mb-0">Your Tasks</h5>
  </div>
  <div class="d-flex gap-2">
    <!-- Filter Buttons -->
    <a href="{{ url_for('main.index', filter='all', sort=sort) }}" 
       class="btn btn-sm {% if filter_type == 'all' %}btn-primary{% else %}btn-outline-primary{% endif %}">
      All
    </a>

    <a href="{{ url_for('main.index', filter='completed', sort=sort) }}" 
       class="btn btn-sm {% if filter_type == 'completed' %}btn-success{% else %}btn-outline-success{% endif %}">
      Completed
    </a>

    <a href="{{ url_for('main.index', filter='pending', sort=sort) }}" 
       class="btn btn-sm {% if filter_type == 'pending' %}btn-warning{% else %}btn-outline-warning{% endif %}">
      Pending
    </a>
  </div>
<!-- üîé Search Bar -->
<div class="mb-3">
  <input 
    type="text" 
    id="searchInput" 
    class="form-control bg-dark text-light border-secondary" 
    placeholder="Search tasks..."
  />
</div>

  <div class="d-flex gap-2">
    <!-- Sort Buttons -->
    <a href="{{ url_for('main.index', filter=filter_type, sort='newest') }}"
       class="btn btn-sm {% if sort == 'newest' %}btn-info{% else %}btn-outline-info{% endif %}">
      ‚¨ÜÔ∏è Newest
    </a>

    <a href="{{ url_for('main.index', filter=filter_type, sort='oldest') }}"
       class="btn btn-sm {% if sort == 'oldest' %}btn-info{% else %}btn-outline-info{% endif %}">
      ‚¨áÔ∏è Oldest
    </a>
  </div>
</div>


<!-- üìù Task List -->
<div class="card p-4 bg-dark text-light">
  <h5 class="mb-3">Manage Your Tasks</h5>

  <form action="{{ url_for('main.add') }}" method="POST" class="mb-4 d-flex gap-2">
    <input type="text" name="task" placeholder="Enter a task..." class="form-control" required>
    <button type="submit" class="btn btn-primary">Add</button>
  </form>

  {% if tasks %}
  <ul class="list-group list-group-flush">
    {% for task in tasks %}
    <li class="list-group-item bg-dark text-light d-flex justify-content-between align-items-center border-secondary">
      <div>
        {% if task.completed %}
        <s class="text-muted">{{ task.content }}</s>
        {% else %}
        {{ task.content }}
        {% endif %}
      </div>
      <div>
        <a href="{{ url_for('main.toggle', id=task.id) }}" class="btn btn-sm {% if task.completed %}btn-outline-warning{% else %}btn-outline-success{% endif %}">
          {% if task.completed %}‚Ü© Undo{% else %}‚úì Done{% endif %}
        </a>
        <a href="{{ url_for('main.update', id=task.id) }}" class="btn btn-sm btn-outline-info">Edit</a>
        <a href="{{ url_for('main.delete', id=task.id) }}" class="btn btn-sm btn-outline-danger">Delete</a>
      </div>
    </li>
    {% endfor %}
  </ul>
  {% else %}
  <p class="text-center text-muted mt-3">No tasks yet. Add one above!</p>
  {% endif %}
</div>
{% endblock %}
<script>
  const searchInput = document.getElementById('searchInput');

  searchInput.addEventListener('keyup', function () {
    const filter = this.value.toLowerCase();
    const tasks = document.querySelectorAll('.task-item');

    tasks.forEach(task => {
      const text = task.textContent.toLowerCase();
      task.style.display = text.includes(filter) ? '' : 'none';
    });
  });
</script>
